<!DOCTYPE html>
<html lang="it">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>progDB</title>

	<script src="https://cdn.tailwindcss.com"></script>
</head>

<script>
	const server = 'http://localhost:8001'
	async function createDB() {
		let res = await fetch(server + '/createTables', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function deleteDB() {
		let res = await fetch(server + '/deleteTables', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit1() {
		const res = await fetch(server + '/op/1', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit2() {
		const res = await fetch(server + '/op/2', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit3() {
		const res = await fetch(server + '/op/3', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit4() {
		const res = await fetch(server + '/op/4', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit5() {
		const res = await fetch(server + '/op/5', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit6() {
		const res = await fetch(server + '/op/6', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit7() {
		const res = await fetch(server + '/op/7', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit8() {
		const res = await fetch(server + '/op/8', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit9() {
		const res = await fetch(server + '/op/9', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit10() {
		const res = await fetch(server + '/op/10', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit11() {
		const res = await fetch(server + '/op/11', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit12() {
		const res = await fetch(server + '/op/12', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit13() {
		const res = await fetch(server + '/op/13', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit14() {
		const res = await fetch(server + '/op/14', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
	async function submit15() {
		const res = await fetch(server + '/op/15', { method:'POST'});
		res = await res.json();
		if(res?.out) document.querySelector('#output').innerText = res.out;
	}
</script>

<body>
	<main class="mb-20 flex flex-col justify-center">
		<h1 class="mx-auto my-8 text-5xl font-bold text-teal-500">RiverFlix</h1>

		<h2 class="mx-auto my-4 text-3xl font-semibold">Creazione dello schema:</h2>

		<div class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Creazione delle tabelle</h3>
				<button id="creteDB" class="py-1 px-2 m-2 border-2 rounded-md" onclick="createDB()">esegui</button>
		</div>
		<div class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Rimozione delle tabelle</h3>
				<button id="creteDB" class="py-1 px-2 m-2 border-2 rounded-md" onclick="deleteDB()">esegui</button>
		</div>


		<h2 class="mx-auto my-4 text-3xl font-semibold">Operazioni sul DB:</h2>

		<ol class="list-decimal mx-8">
			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Inserimento prodotto</h3>
				<pre class="my-2">Query:
	INSERT INTO ProdCinema (Id, Rating, Durata, Budget, Anno, Titolo, CARA, Scadenza, Tipo, Stagione, SerieTV)
	VALUES  (NULL, 10140,165000000,2013,"Interstellar","PG",null,"film",null,null,null)

	INSERT INTO Personale(Codice, Nome, DataNasc, Nazionalità, Compito)
	VALUES ("Regista1","Nolan","1978-10-08","francese","Regista"), ("attore1","Francesco","1988-06-18","americano","Attore");

	INSERT INTO Creazione(ProdCin, Personale)
	VALUES (idFilm, 'Regista1'), (idFilm 'Attore1');
	
	INSERT INTO Parte(ProdCinema, Attore, Ruolo)
	VALUES ('idFilm' , 'Attore1, 'Cane')

	INSERT INTO Categoria(ProdCinema, Genere)
	VALUES ('idFilm' , 'Commedia')

	INSERT INTO Ambientazione(ProdCin, Location)
	VALUES ('idFilm' , 'Giove')</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit1()">esegui</button>
			</li>

			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Rimozione prodotto</h3>
				<pre class="my-2">Query:
	DELETE FROM ProdCinema 
	WHERE Scadenza &lt; CAST(GETDATE() AS Date)</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit2()">esegui</button>
			</li>

			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Aggiornamento prodotto</h3>
				<pre class="my-2">Query:
	UPDATE ProdCinema 
	SET Scadenza = '2025-01-01 
	WHERE  Titolo = 'Interstellar'</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit3()">esegui</button>
			</li>

			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Aggiornamento rating</h3>
				<pre class="my-2">Query:
	UPDATE ProdCinema
	SET Rating = t.meanR
	FROM (
		SELECT ProdCinema, AVG(ProdCinema) as meanR
		FROM Recensione 
		GROUP BY ProdCinema
	) t
	WHERE Id = t.ProdCinema</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit4()">esegui</button>
			</li>

			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Inserimento account</h3>
				<pre class="my-2">Query:
	INSERT INTO Account(Mail, Psw, Abbonamento, DataCreaz) 
	VALUES  ("famiglia@fam.com","12345678","mensile","2025-01-01"), 
			("stevesting@random.com","ciaociao","annuale","2022-10-01"),
			("giuse@gg.com", "123stella","annuale","2020-08-23")</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit5()">esegui</button>
			</li>
			
			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Cambio abbonamento</h3>
				<pre class="my-2">Query:
	UPDATE Account 
	SET Abbonamento = 'annuale PRO'
	WHERE Mail = 'famiglia@fam.com'</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit6()">esegui</button>
			</li>

			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Rimozione account</h3>
				<pre class="my-2">Query:
	DELETE FROM Account 
	WHERE Mail = 'giuse@gg.com'</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit7()">esegui</button>
			</li>
			<li clas
			s="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Inserimento utente</h3>
				<pre class="my-2">	Query:
	INSERT INTO Utente (Nome, Account, Età, Posizione, Ling,
	Disp, TempoUtilizzo)
	VALUES (...)</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit8()">esegui</button>
			</li>

			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Ricerca top visualizzati</h3>
				<pre class="my-2">	Query:
	SELECT Id, Titolo, Tipo
	FROM ProdCinema
	ORDER BY COUNT(Visual) DESC
	LIMIT 5</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit9()">esegui</button>
			</li>

			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Ricerca top 10 mensile</h3>
				<pre class="my-2">	Query:
	SELECT P.Id, P.Titolo, P.Tipo
	FROM ProdCinema as P JOIN Visione as V on 
	P.Id = V.ProdCinema
	WHERE V.Data > DATE_ADD((CAST(GETDATE() AS Date) INTERVAL -1 MONTH))
	GROUP BY V.ProdCinema
	ORDER BY COUNT(V.ProdCinema) DESC
	LIMIT 10</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit10()">esegui</button>
			</li>

			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Ricerca consigliati</h3>
				<pre class="my-2">	Query:
	SELECT P.Id, P.Titolo, P.Tipo
	FROM Visioni as V JOIN ProdCinema as P 
	ON V.ProdCin = P.Id JOIN (
		SELECT P.Genere as FavGen
		FROM Visione as V JOIN ProdCinema as P 
		ON V.ProdCin = P.Id
		WHERE	V.Utente = ... AND V.Account = ...
		GROUP BY P.Genere
		ORDER BY COUNT(*) DESC
		LIMIT 1
	) t ON P.Genere = t.FavGen
	LIMIT 5</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit11()">esegui</button>
			</li>

			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Ricerca prodotto</h3>
				<pre class="my-2">	Query:
	SELECT Id, Titolo, Tipo
	FROM ProdCinema
	WHERE Titolo = 'Interstellar'</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit12()">esegui</button>
			</li>
			
			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Visione prodotto</h3>
				<pre class="my-2">	Query:
	INSERT INTO Visionato (Utente, Account, ProdCinema, Watchtime)
	VALUES (...)</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit13()">esegui</button>
			</li>

			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Valutazione prodotto</h3>
				<pre class="my-2">	Query:
	INSERT INTO Recensione (Utente, Account, ProdCinema,
	Gradimento)
	VALUES (...)</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit14()">esegui</button>
			</li>

			<li class="p-2 m-2">
				<h3 class="mx-auto my-2 font-semibold text-xl">Ricerca informazioni</h3>
				<pre class="my-2">	Query:
	SELECT Rating, Durata, Budget, Anno, CARA, Stagione, SerieTV
	FROM ProdCinema
	WHERE Titolo = 'Interstellar'</pre>
				<button class="py-1 px-2 m-2 border-2 rounded-md" onclick="submit15()">esegui</button>
			</li>

		</ol>

		<h2 class="mx-auto my-4 text-3xl font-semibold">Output:</h2>
		
		<div id="output" class="mx-8 p-4 bg-gray-200">
			
		</div>
	</main>
</body>
</html>